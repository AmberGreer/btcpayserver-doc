(window.webpackJsonp=window.webpackJsonp||[]).push([[97],{816:function(e,t,o){"use strict";o.r(t);var s=o(35),a=Object(s.a)({},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h1",{attrs:{id:"fast-sync-for-bitcoin"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#fast-sync-for-bitcoin"}},[e._v("#")]),e._v(" Fast sync for Bitcoin")]),e._v(" "),o("h2",{attrs:{id:"what-problem-does-fast-sync-solve"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#what-problem-does-fast-sync-solve"}},[e._v("#")]),e._v(" What problem does Fast Sync solve?")]),e._v(" "),o("p",[e._v("When you start a new BTCPay Server, you need to synchronize your Bitcoin node from the genesis block.")]),e._v(" "),o("p",[e._v("Validating from the genesis blocks takes in general 1 or 2 days on affordable servers. (around 10$ per months)")]),e._v(" "),o("p",[e._v("However, on some low powered devices like raspberry PI, synchronization time will take around 2 weeks nowadays. (and it will linearly increase with time)")]),e._v(" "),o("p",[e._v("Fast sync provides a solution to decrease dramatically the synchronization time to minutes or few hours.")]),e._v(" "),o("p",[o("strong",[e._v("Current UTXO Set snapshots only work for Bitcoin Core 0.17.0 or higher. Do NOT use these sets on older versions of Bitcoin Core (0.16.3 or lower)")])]),e._v(" "),o("h2",{attrs:{id:"how-does-fast-sync-solve-it"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#how-does-fast-sync-solve-it"}},[e._v("#")]),e._v(" How does Fast Sync solve it?")]),e._v(" "),o("p",[e._v("In order for Bitcoin software to operate, you do not need all the history of blocks from the genesis.")]),e._v(" "),o("p",[e._v("What you need is the state of Bitcoin up to a certain block (this state is called "),o("code",[e._v("UTXO Set")]),e._v("), and around 300 blocks before this point.")]),e._v(" "),o("p",[e._v("Fast Sync downloads the UTXO Set at a specific block on an external server, and deploy it on your node. We call this file a "),o("code",[e._v("UTXO Set snapshot")]),e._v(".")]),e._v(" "),o("p",[e._v("When your node start up again, it will only need to synchronize from the snapshot, to the latest blocks.")]),e._v(" "),o("h2",{attrs:{id:"what-are-the-downsides-of-fast-sync"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#what-are-the-downsides-of-fast-sync"}},[e._v("#")]),e._v(" What are the downsides of Fast Sync?")]),e._v(" "),o("h3",{attrs:{id:"malicious-utxo-set"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#malicious-utxo-set"}},[e._v("#")]),e._v(" Malicious UTXO Set")]),e._v(" "),o("p",[e._v("Fast Sync can be potentially abused:")]),e._v(" "),o("ol",[o("li",[e._v("The attacker gives you an "),o("code",[e._v("UTXO Set snapshot")]),e._v(" which does not follow Bitcoin consensus")]),e._v(" "),o("li",[e._v("The attacker makes a purchase to your store.")]),e._v(" "),o("li",[e._v("Nodes following the consensus would not recognize the payment as valid, but your node will.")]),e._v(" "),o("li",[e._v("The coins the attacker sent you are just worthless")])]),e._v(" "),o("p",[e._v("Other attacks can completely bring down your node.")]),e._v(" "),o("h3",{attrs:{id:"lightning-network-routing-issues"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#lightning-network-routing-issues"}},[e._v("#")]),e._v(" Lightning Network routing issues")]),e._v(" "),o("p",[e._v("As a merchant, you generally do not care about this issue. Merchants are mainly receiving payment, so they don't need to do any routing.")]),e._v(" "),o("p",[e._v("However, if you plan to send payments from your lightning node, you may have issues:")]),e._v(" "),o("p",[e._v("Because you do not have old blocks, then your lightning node won't see any channels which have been created prior to the snapshot.")]),e._v(" "),o("p",[e._v("If this is a problem for you, just use an older snapshot.")]),e._v(" "),o("h2",{attrs:{id:"how-to-verify-that-the-utxo-set-snapshot-follows-the-consensus"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#how-to-verify-that-the-utxo-set-snapshot-follows-the-consensus"}},[e._v("#")]),e._v(" How to verify that the UTXO Set snapshot follows the consensus?")]),e._v(" "),o("h3",{attrs:{id:"if-you-trust-the-owner-of-this-repository"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#if-you-trust-the-owner-of-this-repository"}},[e._v("#")]),e._v(" If you trust the owner of this repository....")]),e._v(" "),o("p",[e._v("The snapshots recognized as valid by the "),o("code",[e._v("btcpayserver-docker")]),e._v(" repository you cloned can be found on "),o("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker/blob/master/contrib/FastSync/utxo-sets",target:"_blank",rel:"noopener noreferrer"}},[e._v("utxo-sets"),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("p",[e._v("The script "),o("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker/blob/master/contrib/FastSync/load-utxo-set.sh",target:"_blank",rel:"noopener noreferrer"}},[e._v("load-utxo-set.sh"),o("OutboundLink")],1),e._v(" will download the utxo-set from the environment variable "),o("code",[e._v("UTXO_DOWNLOAD_LINK")]),e._v(".")]),e._v(" "),o("p",[e._v("If "),o("code",[e._v("UTXO_DOWNLOAD_LINK")]),e._v(" is empty, "),o("code",[e._v("NBITCOIN_NETWORK")]),e._v(" (with value set to "),o("code",[e._v("mainnet")]),e._v(" or "),o("code",[e._v("testnet")]),e._v(") will be used to take a default "),o("code",[e._v("UTXO_DOWNLOAD_LINK")]),e._v(" that we hard coded inside "),o("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker/blob/master/contrib/FastSync/load-utxo-set.sh",target:"_blank",rel:"noopener noreferrer"}},[e._v("load-utxo-set.sh"),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("p",[e._v("Once the files are downloaded, the hash will be checked against those in "),o("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker/blob/master/contrib/FastSync/utxo-sets",target:"_blank",rel:"noopener noreferrer"}},[e._v("utxo-sets"),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("p",[e._v("However: This only prove that "),o("code",[e._v("if the owner of this git repository is honest")]),e._v(", then the utxo-set are correct.")]),e._v(" "),o("p",[e._v("NOTE: "),o("strong",[e._v("Completing those steps does not mean that the UTXO set snapshot is legit")]),e._v(". It only mean that you trust the owner of this git repositoy to have verified that it is legit.")]),e._v(" "),o("h3",{attrs:{id:"if-you-trust-someone-else"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#if-you-trust-someone-else"}},[e._v("#")]),e._v(" If you trust someone else...")]),e._v(" "),o("p",[e._v("This repository contains the signatures of some developers, for example "),o("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker/blob/master/contrib/FastSync/sigs/NicolasDorier.utxo-sets.asc",target:"_blank",rel:"noopener noreferrer"}},[e._v("sigs/NicolasDorier.utxo-sets.asc"),o("OutboundLink")],1),e._v(" contains the hashes that "),o("code",[e._v("NicolasDorier")]),e._v(" verified himself.")]),e._v(" "),o("p",[e._v("You need to verify with "),o("a",{attrs:{href:"https://keybase.io/docs/command_line",target:"_blank",rel:"noopener noreferrer"}},[e._v("KeyBase command line"),o("OutboundLink")],1),e._v(" that the signature is legit:")]),e._v(" "),o("div",{staticClass:"language-bash extra-class"},[o("pre",{pre:!0,attrs:{class:"language-bash"}},[o("code",[e._v("keybase pgp verify -i sigs/NicolasDorier.utxo-sets.asc\n")])])]),o("p",[e._v("If you don't like command line, you can verify against "),o("a",{attrs:{href:"https://keybase.io/verify",target:"_blank",rel:"noopener noreferrer"}},[e._v("keybase verify page"),o("OutboundLink")],1),e._v(" by just copying and pasting the content of "),o("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker/blob/master/contrib/FastSync/sigs/NicolasDorier.utxo-sets.asc",target:"_blank",rel:"noopener noreferrer"}},[e._v("sigs/NicolasDorier.utxo-sets.asc"),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("p",[e._v("You can verify that the handle "),o("code",[e._v("NicolasDorier")]),e._v(" refers to the person who controls "),o("code",[e._v("NicolasDorier")]),e._v(" twitter, github and reddit handle on "),o("a",{attrs:{href:"https://keybase.io/NicolasDorier",target:"_blank",rel:"noopener noreferrer"}},[e._v("the keybase profile page"),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("p",[e._v("NOTE: "),o("strong",[e._v("Completing those steps does not mean that the UTXO set snapshot is legit")]),e._v(". It only mean that you trust the owner of a Keybase account who has proved access to some social media accounts in the past.")]),e._v(" "),o("h3",{attrs:{id:"dont-trust-verify-"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#dont-trust-verify-"}},[e._v("#")]),e._v(" Don't trust, verify!"),o("a",{attrs:{name:"donttrust"}})]),e._v(" "),o("p",[e._v("If you don't trust anybody, which should be the case as much as possible, then here are the steps to verify that the UTXO set is not malicious.")]),e._v(" "),o("ol",[o("li",[e._v("You need another node that you own, "),o("code",[e._v("under your control")]),e._v(", that "),o("code",[e._v("you synchronized from the genesis block")]),e._v(". Let's call this node "),o("code",[e._v("Trusty")]),e._v(".")]),e._v(" "),o("li",[e._v("You need to create a new node which use "),o("code",[e._v("Fast Sync")]),e._v(" with the UTXO snapshot you want to verify. Let's call this node, "),o("code",[e._v("Synchy")]),e._v(".")]),e._v(" "),o("li",[e._v("Wait that "),o("code",[e._v("Synchy")]),e._v(" is fully synched.")]),e._v(" "),o("li",[e._v("Now on "),o("code",[e._v("Synchy")]),e._v(" and "),o("code",[e._v("Trusty")]),e._v(" run at the same time:")])]),e._v(" "),o("div",{staticClass:"language-bash extra-class"},[o("pre",{pre:!0,attrs:{class:"language-bash"}},[o("code",[e._v(" bitcoin-cli gettxoutsetinfo\n")])])]),o("p",[e._v("If "),o("code",[e._v("Synchy")]),e._v(" or "),o("code",[e._v("Trusty")]),e._v(" are using BTCPay Server use:")]),e._v(" "),o("div",{staticClass:"language-bash extra-class"},[o("pre",{pre:!0,attrs:{class:"language-bash"}},[o("code",[e._v("bitcoin-cli.sh gettxoutsetinfo\n")])])]),o("ol",{attrs:{start:"5"}},[o("li",[e._v("Verify that the output of "),o("code",[e._v("Synchy")]),e._v(" and "),o("code",[e._v("Trusty")]),e._v(" are identical (you can ignore "),o("code",[e._v("disk_size")]),e._v(").")])]),e._v(" "),o("p",[e._v("NOTE: Completing those steps, under the assumption the software you are running is not malicious, "),o("strong",[e._v("correctly prove that the UTXO set snapshot is legit")]),e._v(".")]),e._v(" "),o("h2",{attrs:{id:"faq"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#faq"}},[e._v("#")]),e._v(" FAQ")]),e._v(" "),o("h3",{attrs:{id:"can-i-add-my-signature-to-this-repository"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#can-i-add-my-signature-to-this-repository"}},[e._v("#")]),e._v(" Can I add my signature to this repository?")]),e._v(" "),o("p",[e._v("If you are a bitcoin developer or public figure, feel free to add your signature. For this you need:")]),e._v(" "),o("ol",[o("li",[e._v("A "),o("a",{attrs:{href:"http://keybase.io",target:"_blank",rel:"noopener noreferrer"}},[e._v("keybase account"),o("OutboundLink")],1),e._v(" linked to your social media accounts.")]),e._v(" "),o("li",[e._v("Follow the steps described in the "),o("a",{attrs:{href:"#donttrust"}},[e._v("Don't trust, verify!")]),e._v(" section each snapshots you want to sign.")]),e._v(" "),o("li",[e._v("Create a file with same format as "),o("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker/blob/master/contrib/FastSync/utxo-sets",target:"_blank",rel:"noopener noreferrer"}},[e._v("utxo-sets"),o("OutboundLink")],1),e._v(" with the snapshots you validated. (Let's call this file "),o("code",[e._v("YOU.utxo-sets")]),e._v(")")]),e._v(" "),o("li",[e._v("Run the following command line")])]),e._v(" "),o("div",{staticClass:"language-bash extra-class"},[o("pre",{pre:!0,attrs:{class:"language-bash"}},[o("code",[o("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Assuming your are inside the FastSync directory")]),e._v("\nkeybase pgp sign -i YOU.utxo-sets -c -t -o sigs/YOU.utxo-sets.asc\n"),o("span",{pre:!0,attrs:{class:"token function"}},[e._v("rm")]),e._v(" YOU.utxo-sets\n"),o("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" "),o("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" sigs/YOU.utxo-sets.asc\n"),o("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" commit -m "),o("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Add YOU utxo-set signature"')]),e._v(" --all\n")])])]),o("p",[e._v("And make a pull request to "),o("code",[e._v("btcpayserver-docker")]),e._v(" repository.")]),e._v(" "),o("h3",{attrs:{id:"where-can-i-download-utxo-set-snapshots"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#where-can-i-download-utxo-set-snapshots"}},[e._v("#")]),e._v(" Where can I download UTXO set snapshots")]),e._v(" "),o("p",[e._v("You should not need to do this, because "),o("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker/blob/master/contrib/FastSync/load-utxo-set.sh",target:"_blank",rel:"noopener noreferrer"}},[e._v("load-utxo-set.sh"),o("OutboundLink")],1),e._v(" do the hard work for you.")]),e._v(" "),o("p",[e._v("But if you really want, just browse on "),o("a",{attrs:{href:"http://utxosets.blob.core.windows.net/public?restype=container&comp=list&include=metadata",target:"_blank",rel:"noopener noreferrer"}},[e._v("this listing"),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("p",[e._v("Select the snapshot you want, and download it by querying "),o("code",[e._v("http://utxosets.blob.core.windows.net/public/{blobName}")]),e._v(".")]),e._v(" "),o("h3",{attrs:{id:"how-can-i-create-my-own-snapshot"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#how-can-i-create-my-own-snapshot"}},[e._v("#")]),e._v(" How can I create my own snapshot?")]),e._v(" "),o("p",[e._v("Assuming you have a node running on a docker deployment of BTCPay Server, you just need to run "),o("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker/blob/master/contrib/FastSync/save-utxo-set.sh",target:"_blank",rel:"noopener noreferrer"}},[e._v("save-utxo-set.sh"),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("p",[e._v("This script shows the steps to create an archive of the current UTXO Set\nIt will:")]),e._v(" "),o("ol",[o("li",[e._v("Shutdown BTCPay Server")]),e._v(" "),o("li",[e._v("Start bitcoind")]),e._v(" "),o("li",[e._v("Prune it to up to 289 blocks from the tip")]),e._v(" "),o("li",[e._v("Stop bitcoind")]),e._v(" "),o("li",[e._v("Archive in a tarball the blocks and chainstate directories")]),e._v(" "),o("li",[e._v("Restart BTCPay")]),e._v(" "),o("li",[e._v("If "),o("code",[e._v("AZURE_STORAGE_CONNECTION_STRING")]),e._v(" is set, then upload to azure storage and make the blob public, else print hash and tarball")])]),e._v(" "),o("h3",{attrs:{id:"how-can-i-do-this-for-my-altcoin"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#how-can-i-do-this-for-my-altcoin"}},[e._v("#")]),e._v(" How can I do this for my altcoin?")]),e._v(" "),o("p",[e._v("Your altcoin does not need it, almost nobody use it compared to bitcoin.")]),e._v(" "),o("p",[e._v("However, if you insist, follow what we did for Bitcoin, we can't hand hold you on this.")]),e._v(" "),o("h3",{attrs:{id:"do-you-plan-to-destroy-bitcoin"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#do-you-plan-to-destroy-bitcoin"}},[e._v("#")]),e._v(" Do you plan to destroy Bitcoin?")]),e._v(" "),o("p",[e._v("This feature may be controversial, because of the risk that almost nobody will follow the "),o("a",{attrs:{href:"#donttrust"}},[e._v("Don't trust, verify!")]),e._v(" step.")]),e._v(" "),o("p",[e._v("What if somebody start spreading a corrupted snapshot on wild scale?")]),e._v(" "),o("p",[e._v("I think this issue can be mitigated at the social layer. If several person start using social media for spreading their "),o("code",[e._v("bitcoin-cli getutxosetinfo")]),e._v(" every 10 000 blocks, any corrupt snapshot would be soon detected. We plan to make expose the hash via "),o("code",[e._v("BTCPayServer")]),e._v(" and make it easy for people to share.")]),e._v(" "),o("h3",{attrs:{id:"why-you-dont-just-make-btcpayserver-rely-on-spv"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#why-you-dont-just-make-btcpayserver-rely-on-spv"}},[e._v("#")]),e._v(" Why you don't just: Make BTCPayServer rely on SPV")]),e._v(" "),o("p",[e._v("All SPV solution brings a systemic risk to Bitcoin. If everybody relies on SPV to accept payment and miners want to change consensus rules, then you will have no leverage as individual, nor as a community to decide against.")]),e._v(" "),o("p",[e._v("Even with "),o("code",[e._v("UTXO Set snapshots")]),e._v(" you continue to validate consensus rules from the block of the snapshot.")]),e._v(" "),o("h3",{attrs:{id:"why-you-dont-just-make-btcpayserver-rely-on-an-external-trusted-node"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#why-you-dont-just-make-btcpayserver-rely-on-an-external-trusted-node"}},[e._v("#")]),e._v(" Why you don't just: Make BTCPayServer rely on an external trusted node")]),e._v(" "),o("p",[e._v("Why not just hosting BTCPayServer on the raspberry pi, but the bitcoin full node on another machine?")]),e._v(" "),o("p",[e._v("For two reasons:")]),e._v(" "),o("p",[e._v("First, "),o("code",[e._v("BTCPayServer")]),e._v(" is trying to bring down the technical barriers to operate payments on your own. Running on an external node means that the user need the technical skills to set it up.")]),e._v(" "),o("p",[o("code",[e._v("BTCPayServer")]),e._v(" also relies on Bitcoin's RPC which is not meant to be exposed on internet. We can't see any simple enough solution which would allow normal people to run an external node somewhere else.")]),e._v(" "),o("p",[e._v("The second reason is about reliability: You want your service to be self contained. If you host a node on another server, and for some reason this server goes down, then your "),o("code",[e._v("BTCPayServer")]),e._v(" hosted on the raspberry PI will also cease to function.")])])}),[],!1,null,null,null);t.default=a.exports}}]);